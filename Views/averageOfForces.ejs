

<%- include('./includes/head.ejs') %>

<link rel="stylesheet" href="/css/treeview.css">
</head>
<body style="background-color: rgb(12, 12, 12);">

<%- include('./includes/navigation.ejs') %>
<h1 style="color: white;">Avarage Of Soldiers</h1>

<div class="soldier-info">

<!--Class-->
  <% currSoldiers = 0 %>
  <% for(let i=0;i< soldiers.length; i++) { %>
    <% soldier = soldiers[i]; %> 
    <% if(soldier.Force_id == force_Id){ %>
      <% currSoldiers  += 1 %> 
    <% } %>
  <% } %>
  <% if(currSoldiers > 1){ %>
    <% for(let i=0;i< soldiers.length; i++) { %>
      <% var prevResultArr = resultArr %>
      <% var resultArr = [] %>
      <% soldier = soldiers[i]; %>
      
      <% if(soldier.Force_id == force_Id){ %>
        <% for(let i=0;i< results.length; i++) { %>
          <% result = results[i]; %>
          <% prevresult = results[i]; %>
          <% if(result.soldier_id == soldier.U_id){ %>
          
          <% for(let i=0;i< exercises.length; i++) { %>
            <% lastExercise = exercises[i]; %>
            <% exercise = exercises[i]; %>
            
            <% if(exercise.id == result.exercise_id){ %>
              <% resultArr.push(result.grade) %>
              <%= resultArr %>
              <% } %>
            <% } %>  
          <% } %>
        <% } %>
      <% } %>           
    <% } %>
  <% var sum = resultArr.map(function (num, idx) { %>
    <% return num + prevResultArr[idx]; %>
    <% }); %>
    
    <% for(let i=0;i< forces.length; i++) { %>
      <% force = forces[i]; %>
      <% if(force_Id == force.id) { %>
        <h1 style="text-align: center; color: white;"  ><%= force.name %></h1>
        <% } %>
        <% } %>
        <% for(let i=0;i < exercises.length; i++) { %>
          
          <% let average = sum[i] / currSoldiers %>
          
          <% exercise = exercises[i] %>
          <h1 style="text-align: right; padding: 2.1em; color: white;"><%= exercise.Name %> : <%= average %></h1>
          <% } %>
    <% }else{ %>
      <% for(let i=0;i< forces.length; i++) { %>
        <% force = forces[i]; %>
        <% if(force_Id == force.id) { %>
          <h1 style="text-align: center; color: white;"  ><%= force.name %></h1>
          <% } %>
          <% } %>
          <% for(let i=0;i< soldiers.length; i++) { %>
            <% soldier = soldiers[i]; %>
            <% if(soldier.Force_id == force_Id){ %>
              <% for(let i=0;i<results.length; i++) { %>
                <% result = results[i]; %>
          <% for(let i=0;i<exercises.length; i++) { %>
            <% exercise = exercises[i]; %>
            <% if(exercise.id == result.exercise_id){ %>
              <% if(result.soldier_id == soldier.U_id) { %>
                <h1 style="text-align: right; padding: 2.1em;"><%= exercise.Name %> : <%= result.grade %></h1>
                <% } %>
                <% } %>
                <% } %>
                <% } %>
                <% } %>
                <% } %>
                <% } %>
                
                
                
                
                
                <!--Squad-->
                <% var sum1 = [] %>
                <% var sum2 = [] %>
                <% var sum3 = [] %>
                <% var sumExercise1 = 0 %>
                <% var sumExercise2 = 0 %>
                <% var sumExercise3 = 0 %>
                <% for(let i=0;i < forces.length; i++) { %>
                  <% force_Squad = forces[i]; %>
                  <% var squadResultArr = [] %>
                  <% var prevsquadResultArr = squadResultArr %>
                  <% var departmentResultArr = [] %>
                  <% var prevDepartmentResultArr = squadResultArr %>
                  <% for(i = 0; i< forces.length; i++){ %>
                    <% var prevSumOfSquad = sumOfSquad %>
                    <% var sumOfSquad = [] %>
                    <% var prevSumOfDepartment = sumOfDepartment %>
                    <% var sumOfDepartment = [] %>
                    <% force_Department = forces[i]; %>
    <% if(force_Department.parent_id !== null && force_Department.parent_id == force_Id){ %>
      <% for(let i=0;i< forces.length; i++) { %>
        <% force_Class = forces[i]; %>
        <% if(force_Class.parent_id == force_Department.id && force_Department.parent_id !== null){ %>
          <% force_Class.id %> 
          <% for(let i=0;i< soldiers.length; i++) { %>
            
            <% soldier = soldiers[i]; %>
            <% if(soldier.Force_id == force_Class.id){ %>
              
              <% for(let i=0;i< results.length; i++){ %>
                <% result = results[i]; %>
                <% prevresult = results[i]; %>
                <% if(soldier.U_id == result.soldier_id){ %>
                  <% squadResultArr.push(result.grade) %>
                  
                  <% result.grade %>
                  <% for(let i=0;i< exercises.length; i++){ %>
                    <% exercise = exercises[i];%>
                    <% } %>
                    <% } %>
                    <% } %>
                    <% } %>
                    <% } %>                           
                    <% } %>
                    
                    <% } %>
                    <% var departmentResultArr = [] %>
                    
                    <% if(force_Department.parent_id !== force_Squad.id && force_Department.parent_id !== 2 && force_Department.parent_id !== 3){ %>
                      <% for(let i=0;i< soldiers.length; i++) { %>
                        <% soldier = soldiers[i]; %>
                        <% if(force_Department.id == soldier.Force_id){ %>
                          <% for(let i=0; i< results.length; i++){ %>
                            <% result = results[i]; %>
                            <% if(soldier.U_id == result.soldier_id){ %>
                              <% departmentResultArr.push(result.grade) %>
                              <% }; %>
                              <% } %>
                              <% const chunkedResults =[] %>
                              <% for(let soldierResult of departmentResultArr){ %>
                                <% let last = chunkedResults[chunkedResults.length-1]; %>
                                <% if(!last || last.length === exercises.length){ %>
                                  <% chunkedResults.push([soldierResult]) %>
                                  <% } else{ %>
                                    <% last.push(soldierResult); %>
                                    <% } %>
                                    <% } %>
                                    
                                    <%= chunkedResults %><br>
                                    <!--Fixlater-->
                                    <%  sum1 += chunkedResults[0][0] %>
                                    
                                     <%= sum1 %><br>
                                    
                                    <% } %>
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    <% } %>
                                    <% } %>
                                    <% } %>
                                    <% } %>
                                    <% } %>
                                    <% let lengthOfExercisesInArr = 0; %> 
                                    <% var i,j, temporary, chunk = exercises.length; %>
                                    <% for (i = 0,j = squadResultArr.length; i < j; i += chunk) { %>
                                      <% temporary = squadResultArr.slice(i, i + chunk);%>
                                      <% var i,j, temporary, chunk = exercises.length; %>
                                      <% for (i = 0,j = prevsquadResultArr.length; i < j; i += chunk) { %>
                                        <% prevTemporary = prevsquadResultArr.slice(i, i + chunk);%>
                                        <% var squadSum = temporary.map(function (num, idx) { %>
                                          <% return num + prevTemporary[idx]; %>
                                          <% }); %>
                                          <% for(let i=0;i< exercises.length; i++){ %>
                                            <% exercise = exercises[i];%>
                                            <% lengthOfExercisesInArr +=1 %>
                                            <%  prevSumOfSquad.push(squadSum[i]); %>
                                            <%  sumOfSquad.push(squadSum[i]); %>
                                            <% } %>
                                            <!--fix-->
                                              <% sumExercise1 += squadSum[0] %>
                                              <% sumExercise2 += squadSum[1] %>
                                              <% sumExercise3 += squadSum[2] %>
                                              <% lengthOfSoldiersInArr = lengthOfExercisesInArr / 3 %>

                                  <% } %>
                                    <%= (sumExercise1)/lengthOfSoldiersInArr %><br>
                                    <%= (sumExercise2)/lengthOfSoldiersInArr %><br>
                                    <%= (sumExercise3)/lengthOfSoldiersInArr %><br>
                                  
                                <% } %>
                           
                            
                            
                          </div>
                          
                          <div  class = "scrolling-area">
                            <div class= "scrolling-element-inside">
                <% force_Type = "Squad" %>
                <% for(let i=0;i< forces.length; i++) { %>
                  <% force_Squad = forces[i]; %>
                  <% force_Id = force_Squad.id %>
                  <% if(force_Squad.parent_id == null){ %>
        <% force_Type = "Squad" %>
        
        <li style="list-style-type: none ;"><span id="<%= force_Squad.parent_id %>" class="caret"></span>
          <a  style="background-color: rgb(26, 25, 25); position: relative; left: 1.5em; width:40em; height: 4em ;" href="/average-Of-Forces/<%= force_Squad.id %>" class="btn"><%= force_Squad.name %> </a>
          <ul class="nested">
                <% force_Type = "Department" %>
                <% for(let i=0;i< forces.length; i++) { %>
                  <% force_Department = forces[i]; %>
                  <% force_Id = force_Department.id %>
                  <% if(force_Department.parent_id == force_Squad.id){ %>
                    <% force_Type = "Department" %>
                    <li><span id="<%= force_Department.id %>" class="caret"></span>
                      <a  style=" background-color: rgb(43, 46, 45);position: relative; right: 0.1em;width:38em; height: 4em ;" href="/average-of-forces/<%= force_Department.id %>" class="btn"><%= force_Department.name %> </a>
                      <ul class="nested">
                        <% force_Type = "Class" %>
                        <% for(let i=0;i< forces.length; i++) { %>
                          <% force_Class = forces[i]; %>
                          <% force_Id = force_Class.id %>
                          <% if(force_Class.parent_id == force_Department.id){ %>
                            <% force_Type = "Class" %>


                              <% for(let i=0;i< soldiers.length; i++) { %>
                                <% soldier = soldiers[i]; %>
                                <% for(let i=0;i< results.length; i++) { %>
                                  <% result = results[i]; %>       
                                  <% if(soldier.Force_id == force_Id){ %>
                                    <% if(result.soldier_id == soldier.U_id){ %>
                                      
                                      <% for(let i=0; i< exercises.length; i++){ %>
                                        <% exercise = exercises[i]; %>

                                     
 
                                      <% } %> 
                                    <% } %> 
                                  <% } %>
                                <% } %> 
                              <% } %>
                            <li><a id="" style="background-color: rgb(136, 136, 136); position: relative; right: 2.6em; margin:1em; width:36em; height: 4em ;" href="/average-of-forces/<%= force_Class.id %>" style= "margin: 1em" class="btn"><%= force_Class.name %> </a>
                              <ul class="nested">                                
                              </ul>
                          <% } %>
                        <% } %>
                      </ul>
                      
                    </li>
                    
                  <% } %>
                <% } %>
              </ul>
            </li>
            <% } %>
      <% } %>
</div>
</div>
    


  </body>
  <script type="text/javascript">
    var toggler = document.getElementsByClassName("caret");
var i;

for (i = 0; i < toggler.length; i++) {
toggler[i].addEventListener("click", function() {
this.parentElement.querySelector(".nested").classList.toggle("active");
this.classList.toggle("caret-down");
});
}
</script>
  </html>